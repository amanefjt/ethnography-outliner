# 実装計画：ドラッグ＆ドロップ修正とUI全体調整

## 変更対象リスト
- `main.js`: ドラッグロジックの修正、連動移動の安定化、重複コードの削除。
- `index.html`: 不要なアイコン要素の削除。
- `style.css`: カードIDのスタイル調整、プレミアムなビジュアル（影、グラデーション）の適用。

## 設計方針

### 1. ドラッグ＆ドロップの修正 (Rationale)
現在のコードでは `state.dragItem` に「ID」が格納されていますが、`drag` 関数内では `state.dragItem.x = nx` のようにオブジェクトとして扱おうとして不具合が起きています。
- **解決策**: `drag` 関数の冒頭で ID からオブジェクトを再取得するか、`state.dragItem` 自体をオブジェクト参照に変更します。今回は一貫性を保つため、`drag` 関数内で ID に基づき現在のオブジェクトを取得する方式を採用します。これにより、状態が変化しても常に最新の参照にアクセスできます。

### 2. グループ連動移動の整理
`moveGroupAndChildren` 関数が既に存在しますが、`drag` 関数内での呼び出しと `state.dragItem` の更新が競合しないよう整理します。

### 3. ビジュアルの改善
- カードの ID 表示を `opacity: 0.3` 程度に下げる、またはホバー時のみ表示するように変更します。
- 鎖アイコン（以前の要望で非表示にしていたもの）に関連する DOM と CSS を物理的に削除し、DOMツリーを軽量化します。

### 4. コードの整理
`main.js` 内で `inp.onchange` が重複して定義されている箇所などを整理し、クリーンなコードベースに戻します。

## 設計を選んだ根拠 (Rationale)
- **バグ修正の確実性**: ID参照をオブジェクト参照に正規化することで、JavaScript の「参照渡し」によるバグを根絶します。
- **UI/UXの向上**: 不要な情報を減らすことで、ユーザーがコンテンツ（フィールドノート）に集中できる環境を作ります。
- **パフォーマンス**: 不要なアイコンやイベントリスナーの削除は、キャンバス上に多数のカードがある場合の描画負荷を軽減します。
