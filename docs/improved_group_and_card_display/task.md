# Task: グループ・カード表示および操作性の改善

## 目的
グループ操作の直感性を向上させるとともに、カード配置や表示オプションを改善して、画面上の情報整理をスムーズにする。特に階層化されたグループの移動や、情報の折りたたみ表示による視認性向上を目指す。

## Checklists

### 1. 設計と準備
- [x] 要件の詳細化と実装計画の策定 (`implementation_plan.md`) @docs/improved_group_and_card_display/implementation_plan.md

### 2. データ構造とステート管理の更新
- [x] グループおよびノートのモデルに `collapsed` (折りたたみ状態) フラグを追加
- [x] グループの階層構造（親子関係）を適切に扱うためのヘルパー関数の整備（`getChildren` 等）

### 3. ドラッグ＆ドロップロジックの改善 (上位グループ連動)
- [x] `drag` 関数内でのグループ移動処理の修正
- [x] 再帰的に子要素（下位グループ・所属ノート）を特定し、移動量を適用するロジックの実装

### 4. 新規カード配置ロジックの実装
- [x] 画面中央（または視点中心）周辺の空きスペースを探索するアルゴリズムの実装
- [x] `saveNote` および `addGroup` 関数での初期位置決定ロジックの変更

### 5. UI/UXの改善
- [x] **ID表示の縮小**: CSS修正によりカード内のIDを目立たなくする
- [x] **リンクアイコンの削除**: ノート作成時のHTMLからリンク（鎖）アイコンボタンを削除
- [x] **ノートの折りたたみ機能**:
    - [x] タイトルがあるノートに折りたたみトグルボタンを追加
    - [x] 折りたたみ時の表示スタイル実装（本文非表示、高さ自動調整）
- [x] **グループの折りたたみ機能**:
    - [x] グループヘッダーに折りたたみトグルボタンを追加
    - [x] 折りたたみ時の動作実装（子要素の非表示、グループサイズの縮小）

### 6. 検証と調整
- [x] 各機能の動作確認と微調整
- [ ] `walkthrough.md` の更新

## Definition of Done (DoD)
- 上位グループをドラッグすると、含まれるすべての要素が連動して移動すること。
- 新規作成されたカード/グループが、既存のカードと重ならないような適切な位置（中央付近）に出現すること。
- カードIDが小さく表示され、リンクアイコンが削除されていること。
- タイトル付きのノートおよびグループを折りたたんで、タイトルのみ表示できること。
