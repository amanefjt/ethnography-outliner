# 実装計画：折りたたみ機能の修正とアウトライナーの並び替え実装

## 変更対象リスト
- `main.js`: `renderOutline`, `createOutlineItem`, ドラッグ＆ドロップイベントの追加、`state.outlineOrder` の管理。
- `style.css`: `.group-header` の配置修正、アウトライナーのドラッグ用スタイル、折り畳み時のビジュアル。

## 設計方針

### 1. 折りたたみ状態の視覚的改善 (Rationale)
現在のグループヘッダーが `top: -24px` と枠外に配置されているため、`overflow: hidden` が適用される折りたたみ時に消えてしまいます。
- **解決策**: ヘッダーを枠内（最上部）に配置し、背景色をつけて「バー」のように見せます。これにより、折りたたんでもタイトルとボタンが常に操作可能になります。
- **ユーザー要望の反映**: 「小さくする必要はない」との点から、折りたたみ時もタイトルの視認性を確保しつつ、中身（ノート）だけを隠すようにします。

### 2. アウトライナーの並び替えロジック
- **データ構造**: `state.outlineOrder` を `{ parentId: [id1, id2, ...] }` という形式のオブジェクトにします。ルート階層は `root` キーで管理します。
- **ドラッグ＆ドロップ**: 
    - 各 `.outline-item` に `draggable="true"` を付与。
    - `dragstart` で移動対象の ID を保持。
    - `drop` 時に、挿入位置を計算して `state.outlineOrder` を更新。
- **キャンバスとの分離**: この順序は `renderOutline` でのみ使用し、`renderCanvas` では引き続き座標に基づいた描画を行うことで、キャンバスの自由配置を壊さずに構造化を可能にします。

## 設計を選んだ根拠 (Rationale)
- **アクセシビリティ**: ヘッダーを枠内に収めることで、どのようなズームレベルや状態でも操作ボタンを失わずに済みます。
- **階層構造の維持**: `parentId` 別の順序管理により、ネストされたグループ内での入れ替えも正確に行えます。
- **UXの一貫性**: ドラッグ＆ドロップによる直感的な並び替えは、情報の構造化（エスノグラフィーの分析工程）において不可欠な体験です。
